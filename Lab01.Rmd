---
title: "GLME: Lab 1"
#author: "Ofer Engel"
output: html_document
---

<style>
.column-left{
  float: left;
  width: 60%;
  text-align: left;
}
.column-right{
  float: right;
  width: 40%;
  text-align: right;
}
.column-full{
  float: none;
  width: 100%;
  text-align: left;
}
</style>

```{r setup, include=FALSE}

knitr::opts_chunk$set(echo = FALSE)
library(knitr)

```


```{r, fig.width=4}

include_graphics("images/under-construction.png")

```


All datafiles can be found in the shared folder under `datasets`. For testing, use $\alpha=0.05$ unless otherwise specified. 

1. This exercise practices the use and interpretation of re-centering explanatory variables and the effect of co-linear explanatory variables. 
In the data file `practical1_cf.sav` you can find data from 25 patients with cystic fibrosis. The outcome variable is the index of respiratory muscle strength `pemax` (maximal static expiratory pressure, a measure of malnutrition, in cmH~2~O). We focus on explanatory variable height to predict `pemax` first. 
  a.	Explore the data and make a scatterplot of pemax and height. Regress pemax on height and write down the regression equation. Interpret the two regression coefficients. Use the software to calculate confidence intervals for the coefficients. 

  b.	Re-center height around 150 cm (i.e. create a new variable that ``shortens’’ everyone by 150 cm). Make a new scatter plot and compare this with the previous one. Now repeat the analysis, using this variable as the explanatory variable. What is the interpretation of the coefficients? Compare the results of this model with the previous model. 
Hint for SPSS: use transform $\rightarrow$ compute.
  c.	Based on this model, what is the confidence interval for predicted mean `pemax` for someone with a height of 150 cm?
  d.	Add weight to the model. How does the coefficient of height change and why? Did the model improve? Which model would you prefer for predicting `pemax`?
  e.	Check the assumptions of the regression analysis of your final model. 


2 This exercise shows how to incorporate and interpret categorical explanatory variables in a linear regression analysis and practices model building techniques. The data file `practical1_lowbw.sav` contains data from 189 baby’s (birth weight, outcome) and their mothers (explanatory variables `age`, `smoking` status (0 = non-smoker, 1 = smoker), socioeconomic status (`SES`, see below).
a.	Test if mothers who smoke during pregnancy have on average children with the same birth weight as mothers who do not smoke during pregnancy.
b.	Test if age of the mother has an effect on their children’s birth weight.

The categorical variable socioeconomic status (ses) is coded with values 1 (low SES), 2 (middle SES) and 3 (high SES). As these values are chosen arbitrarily, the variable cannot be used in a linear regression model in this form. We therefor need to create dichotomous dummy variables which represent this variable. For a categorical variable with three categories, we need two dummy variables (d1, d2):

INSERT TABLE HERE

This way, the low SES group is the reference group (the group for which d1=d2=0). Those in the middle SES category have d1=1 and d2=0, those in the high SES category d1=0 and d2=1. The dummy variables belong together: they contain all information previously held by ses and should be treated as one in the analysis to maintain the correct interpretation. 

c.	Create dummy variables d1  (middle SES) and d2 (high SES) as described above and perform the linear regression for birth weight on ses using d1  and d2. Interpret the results.
Hint for SPSS: us transform > compute,  target variable: d1 , Numeric expression: Group = 2
And ... // target variable: d2 // Numeric expression: Group = 3, or use transform > recode.

d.	Create the best model to predict birth weight using the three possible explanatory variables and check model assumptions. Write down the regression equation. 

e.	Based on this model, what is the predicted birth weight for a  baby with a smoking, high SES mother of age 35? Figure out how to obtain predictive values for birth weight for all babies represented in the data file. 


3 This exercise practices the use and interpretation of an interaction effect in a linear regression model. 
The data file practical1_hyper1.sav contains data on a study on hypertension among the elderly performed in 1995. We focus on predicting systolic blood pressure (`sbp95`)  using variables age and gender (where gender=1 denotes a female, otherwise: not female).

a.	Make a plot and perform the analysis to answer the question: is systolic blood pressure related to age, ignoring the effect of gender?

b.	Make a plot and perform the analysis to answer the question: is systolic blood pressure related to gender, ignoring the effect of age?

c.	Perform a multiple linear regression using both age and gender and interpret the results. 

d.	Make a scatter plot of `sbp95`  and `age93`. Use colour coding to distinguish men and women and plot regression lines for each subgroup. Does the effect of age on blood pressure seem to differ for men and women? 

To test if the difference in slope between the two groups is significantly different from 0, we introduce and test the interaction effect between variables age  and  gender. For this, we create a new variable `ageg` which is defined as $X_{age}\cdot X\cdot{gender}$  and test its significance in a multiple linear regression analysis containing both this variable and the two main effects (age and gender).

e.	Create this variable `ageg`  and perform a linear regression for systolic blood pressure on age, gender and the interaction variable. Write down the regression equation. What is the increase in sbp per year for men? What is it for women? Determine the 95%-for confidence interval for the difference in slope.  Is this difference significantly different from 0? 

4. This exercise recreates the logistic regression model for the heart disease study from today’s lecture. 
In the data file `practical1_chd.sav`, you find the dichotomous outcome variable for the occurrence of heart disease (chd, 0 = no, 1 = yes) and explanatory variables denoting the number of daily smoked cigarettes (cigs) and height in inches.

a.	Rebuild the logistic regression model as shown in today’s lecture. Based on this model, what is the estimated effect (odds ratio) of height on chd, for fixed smoking behaviour? Is this effect significantly different from 0?

b.	Based on this model, what is the estimated effect of smoking a pack a day (=20 cigarettes) on the  risk of chd compared to a non-smoker?

