<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>GLME: Lab 4</title>

<script src="site_libs/header-attrs-2.10/header-attrs.js"></script>
<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>


<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>







<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Generalized Linear Mixed Effects</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-home"></span>
     
    Overview
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-flask"></span>
     
    Labs
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="Lab01v01.html">Lab 1</a>
    </li>
    <li>
      <a href="Lab02.html">Lab 2</a>
    </li>
    <li>
      <a href="Lab03.html">Lab 3</a>
    </li>
    <li>
      <a href="Lab04.html">Lab 4</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">GLME: Lab 4</h1>

</div>


<style>
.column-left{
  float: left;
  width: 60%;
  text-align: left;
}
.column-right{
  float: right;
  width: 40%;
  text-align: right;
  font-size: 10px;
}

.column-right-text-left{
  float: right;
  width: 40%;
  text-align: left;
}

.column-full{
  float: none;
  width: 100%;
  text-align: left;
}

.RUsers {
  padding: 1em;
  background: aliceblue;
  color: black;
}



.SPSS {
  padding: 1em;
  background: whitesmoke;
  color: black;
}

.center {
  text-align: center;
}

</style>
<p>For testing, use <span class="math inline">\(\alpha=0.05\)</span> unless otherwise specified. Datsets can be found under our <a href="https://bit.ly/3puop3I">shared drive</a>.</p>
<div id="exercises-1" class="section level1">
<h1>Exercises 1</h1>
<p>This exercise examines longitudinal data analyses as shown in the lecture in the context of a different study and data file. You wil focus on the choice of the random part of the model, and various comparisons.</p>
<p>Open the data file <code>practical4_imp1.sav</code>. The data consists of an outcome variable IMP (Infant Motor Profile) that is a summary measure for neurological performances in children. IMP is scaled to a percentage from 0 to 100 (higher is better). The children in this study were tested around ages four months, ten months and eighteen months. The variable period indicates the three periods in months (4, 10, and 18), while the variable time is a continuous measure in weeks. The children were born from mothers that were treated for fertility under different conditions: COH-IVF, MNC-IVF, and SUB-NC. The first two groups received IVF treatments with and without ovarian hyper-stimulation, respectively, and the third group is the control group.</p>
<ol style="list-style-type: lower-alpha">
<li>Investigate the distribution of the <code>IMP</code> variable: describe how its distribution changes depending on the period and on the treatment. What are your conclusions just based on the descriptive investigation of this variable?</li>
</ol>
<p><img src="Lab04_files/figure-html/dist-IMP-1.png" width="672" /></p>
<ol start="2" style="list-style-type: lower-alpha">
<li>Make a graph of the <code>IMP</code> test scores with respect to the variable <code>period</code> or the variable <code>time</code>. What can you say about the linearity of the time profile.</li>
</ol>
<div class="SPSS">
<p>The SPSS syntax for the graph is</p>
<p>GRAPH  /LINE(MULTIPLE)=MEAN(IMP) BY period BY patientnr.</p>
<p>If you would like to see the graph for each treatment group separately, first use Data–Split File</p>
</div>
<div class="RUsers">
<p>Note that by using <code>period</code> instead of <code>time</code> as your independent variable, we generate a slightly better looking graphs, but this means that all responses are set at fixed time points (e.g., exactly 4 months), which is not necessarily precise. For evaluation of the time profile it satisfies our goal, though, time seems to influence IMP quadratically (parabolic shape).</p>
</div>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># For *R Users:*</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Try the following: </span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">read.spss</span>(<span class="st">&quot;data/practical4_imp1.sav&quot;</span>, <span class="at">to.data.frame =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Separate trajectory for each patient</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(d) <span class="sc">+</span> </span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y=</span>_____, <span class="at">x=</span>_____, </span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">group=</span>_____, <span class="at">color=</span>_____))</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Separate trajectory for each treatment</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(d <span class="sc">%&gt;%</span> <span class="fu">na.omit</span>(IMP) <span class="sc">%&gt;%</span>  <span class="fu">group_by</span>(_____, _____) <span class="sc">%&gt;%</span> <span class="fu">summarize</span>(<span class="at">IMP=</span><span class="fu">mean</span>(_____))) <span class="sc">+</span> </span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y=</span>_____, <span class="at">x=</span>_____, <span class="at">color=</span>_____))</span></code></pre></div>
<ol start="3" style="list-style-type: lower-alpha">
<li>Fit a model with random effects for the intercept and the time effect, and fixed effects for the treatment, the time, the quadratic time and for the relevant interactions. Take the covariance matrix for the intercept and slope (linear time) term unstructured.</li>
</ol>
<!-- Create a table comparing the `-2loglikelihood` values, the `AIC`, and `BIC`. What are your conclusions? -->
<div class="RUsers">
<p><em>Note to all users</em></p>
<p>Before fitting the model, centralize the <code>time</code> by subtracting its mean from it, and dividing the result by its standardized deviation. You will find that your new variable <code>time_c=(time-47)/25</code>.</p>
<p>You may choose a random effect for the intercept and for the slope of the variable <code>time_c</code>, but you will not be able to choose a random effect for quadratic time in your model. Although SPSS will estimate the quadratic term, R would refuse, and rightly so. There are too little observations (3 and sometimes even less per child) to correctly identify a random quadratic term as well.</p>
<p>Your model will look as follows:</p>
<span class="math display">\[\begin{aligned}
Y_{IMP} &amp;= b_{0i} + b_{1i}\cdot X_{time_c}+ b_2\cdot X_{trt} + b_3\cdot X_{time_c}^2 + b_4\cdot X_{trt}\cdot X_{time_c} + b_5\cdot X_{trt}\cdot X_{time_c}^2 + e_{ij} \\

b_{0i} &amp;= \beta_{00} + a_{0i} \\
b_{1i} &amp;= \beta_{10} + a_{1i} 

\end{aligned}\]</span>
<p><em>R Users</em> : The formula you will be using in your <code>reml</code> function would look like this (remember to center your <code>time</code> variable):</p>
<p><code>IMP ~ 1 + treatment + time_c+ time_c2 + treatment*time_c + treatment*time_c2 + (1 + time_c | patientnr)</code></p>
</div>
<ol start="4" style="list-style-type: lower-alpha">
<li>For each of the three treatments, write how the expected <code>IMP</code> variable depends on the <code>time</code> variable. What are the expected <code>IMP</code> scores at periods 4, 10 and 18 months in each of the treatment groups?</li>
</ol>
<div class="RUsers">
You will need one equation like the one provided below for each of the three treatments.<br />

<span class="math display">\[\begin{aligned}

\mathbb{E}[Y_{IMP}|X_{trt} &amp;= \textrm{SUB-NC}] = b_0 + b_1\cdot X_{time_c} + b_2\cdot X^2_{time_c}  \\
&amp;=  b_0 + b_1\cdot (X_{time}-47)/25 + b_2\cdot [(X_{time_c}-47)/25]^2

\end{aligned}\]</span>
<p>Since <span class="math inline">\(X_{time}\)</span> is measured in weeks and not in months, you may assume that 4 months is about 17 weeks, 10 months is about 44 weeks and 18 months is about 78 weeks.</p>
</div>
<ol start="5" style="list-style-type: lower-alpha">
<li>Fit an unstructured <em>marginal model</em> with a mean time trajectory that is again quadratic in time for each treatment. What are the <code>-2loglikelihood</code> value, the <code>AIC</code> and <code>BIC</code>? Compare the values with the best model from previous analyses.</li>
</ol>
<div class="RUsers">
<p>For the marginal model we use the <code>period</code> variable instead of the <code>time</code> variable - but only as random time factor for the error covariance matrix.</p>
<p>If we had used the variable <code>time</code>, we would have obtained a new category for each unique value of time (since time is quite different for each of the subjects). This model could probably not be fit at all, since the data set would have been too small.</p>
<p>Furthermore, note that in this model the correlation between observations is independent of the real time differences for subjects at the three periods 4, 10 and 18 months. In other words, the correlation between the IMP for a child at 4.1 and 9.8 is the same as the correlation for a child with time points 3.8 and 10.2, for instance. This is acceptable only if these differences are small and close to each other compared to the distances in the periods. If this is unacceptable, the model proposed here should not have been fitted.</p>
<p><strong>For R Users</strong></p>
<p>Estimate the model given the code shown below. We have to add an extra line to tell the analysis to omit missing values (if you leave that out, the analysis will stop).</p>
<p>The variable <code>period</code> in the <code>weights</code> statement is treated as a categorical variable to be able to generate the variance-covariance matrix across time points. Period has only three levels, which means that R would build a three-dimensional normal distribution for the residuals in the model.</p>
</div>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>mdl <span class="ot">&lt;-</span> <span class="fu">gls</span>(IMP <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> treatment <span class="sc">+</span> time_c <span class="sc">+</span> time_c2 <span class="sc">+</span> treatment<span class="sc">*</span>time_c <span class="sc">+</span> treatment<span class="sc">*</span>time_c2, </span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">data =</span> ________,</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">correlation =</span> <span class="fu">corSymm</span>(<span class="at">form=</span> <span class="sc">~</span> <span class="dv">1</span><span class="sc">|</span> patientnr),</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">weights=</span> <span class="fu">varIdent</span>(<span class="at">form =</span> <span class="sc">~</span> <span class="dv">1</span> <span class="sc">|</span> period),</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">na.action=</span>na.omit,</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">method=</span><span class="st">&quot;REML&quot;</span>)</span></code></pre></div>
<div class="column-right-text-left">
<p><img src="images/ex41e.png" width="156" /></p>
<p>The marginal model uses the /REPEATED statement instead of the <code>/RANDOM</code> statement (choose <code>unstructured</code>).</p>
</div>
<div class="SPSS">
<p><strong>For SPSS Users</strong></p>
<p>The marginal model uses the /REPEATED statement instead of the <code>/RANDOM</code> statement (choose <code>unstructured</code>). Note that we must take <code>period</code> in the repeated statement. This is necessary because this variable is treated as a categorical variable to be able to generate the variance-covariance matrix across time points. Period has only three levels, which means that SPSS would built a three-dimensional normal distribution for the residuals in the model.</p>
</div>
<ol start="6" style="list-style-type: lower-alpha">
<li><p>Again determine the mean profile for the reference group and provide expected <code>IMP</code> scores for 4, 10, and 18 months in this group. Compare your predictions to the results in your previous analysis.</p></li>
<li><p>Fit an unstructured marginal model with a mean per <code>treatment</code> and <code>period</code> (mean saturated model). In other words, this final model ignores the time differences between subjects as a whole (in the variance-covariance and in the mean profile) and assumes that all times can be treated as a categorical variable. What are the <code>-2loglikelihood</code> value, the <code>AIC</code>, and <code>BIC</code>? Compare the values with the best model from previous analyses. Is this comparison allowed? If not what would you do to make the comparison reliable?</p></li>
</ol>
<div class="RUsers">
<p>The code is very similar to the previous one, but this time we ignore the time differences between subjects as a whole (in the variance-covariance and in the mean profile) and assume that the times can be treated as a categorical variable. The script is given by:</p>
</div>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>mdl <span class="ot">&lt;-</span> <span class="fu">gls</span>(IMP <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> treatment <span class="sc">+</span> period <span class="sc">+</span> treatment<span class="sc">*</span>period, </span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">data =</span> ________,</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">correlation =</span> <span class="fu">corSymm</span>(<span class="at">form=</span> <span class="sc">~</span> <span class="dv">1</span><span class="sc">|</span> patientnr),</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">weights=</span> <span class="fu">varIdent</span>(<span class="at">form =</span> <span class="sc">~</span> <span class="dv">1</span> <span class="sc">|</span> period),</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">na.action=</span>na.omit,</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">method=</span><span class="st">&quot;REML&quot;</span>)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="fu">gls</span>(IMP <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> treatment <span class="sc">+</span> period <span class="sc">+</span> treatment<span class="sc">*</span>period,</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> imp1,</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>                <span class="at">correlation =</span> <span class="fu">corSymm</span>(<span class="at">form=</span> <span class="sc">~</span> <span class="dv">1</span><span class="sc">|</span> patientnr),</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>                <span class="at">weights=</span> <span class="fu">varIdent</span>(<span class="at">form =</span> <span class="sc">~</span> <span class="dv">1</span> <span class="sc">|</span> period),</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>                <span class="at">na.action=</span>na.omit,</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>                <span class="at">method=</span><span class="st">&quot;REML&quot;</span>) </span></code></pre></div>
<ol start="8" style="list-style-type: lower-alpha">
<li>What are the expected <code>IMP</code> scores at 4, 10 and 18 months?</li>
</ol>
<div class="SPSS">
<p>For <strong>SPSS users</strong></p>
<p>You can get this from the output using <code>\EMMEANS</code>.</p>
</div>
<div class="RUsers">
<p>For <strong>R users</strong></p>
<p>Try using <code>library(emmeans)</code> and add <code>mode="df.error"</code> to circumvent Satterthwaite-related estimation issues.</p>
</div>
</div>
<div id="exercise-bonus" class="section level1">
<h1>Exercise (bonus)</h1>
<div class="column-right-text-left">
<p><img src="images/subjectspecmodel.jpg" width="375" /> The population variance at time t in the subject specific model.</p>
</div>
<p>This exercise uses (high-school) mathematics to further investigate properties of the population variance as defined in the subject specific model.</p>
<span class="math display">\[\begin{aligned}
Y_{ij} &amp;= b_{0i} + b_{1i}\cdot X_{time} + e_{ij} \\

b_{0i} &amp;= \beta_{00} + a_{0i} \\
b_{1i} &amp;= \beta_{10} + a_{1i} \\

&amp;\text{and therefore the composite equation becomes...} \\

Y_{ij} &amp;= \beta_{00} + \beta_{10}\cdot X_{time} + [ a_{0i} + a_{1i}\cdot X_{time} +  e_{ij} ] 

\end{aligned}\]</span>
<p>Where <span class="math inline">\(a_{0i}\)</span> and <span class="math inline">\(a_{1i}\)</span> covary accoding to the following relationship:</p>
<span class="math display">\[\begin{aligned}

\begin{gather}
 \begin{bmatrix} 
    a_{0i} \\ 
    a_{1i} 
 \end{bmatrix}
 &amp;\sim \mathcal{N}
 \begin{pmatrix}
  \begin{bmatrix} 
    0 \\ 
    0 
  \end{bmatrix}
 , 
 \begin{bmatrix} 
    \tau_0^2 &amp; \rho\tau_0\tau_1 \\ 
    \rho\tau_0\tau_1 &amp;  \tau_1^2
  \end{bmatrix}
 
 \end{pmatrix}   
   
   
\end{gather}

\end{aligned}\]</span>
<p>The variance of our residual is now:</p>
<span class="math display">\[\begin{aligned}
\sigma^2_{r_{ij}} &amp;= Var[a_{0i} + a_{1i}\cdot X_{time} +  e_{ij} ] \\
&amp;= \tau_0^2 + 2\rho\tau_0\cdot\tau_1\cdot X_{time}   + \tau_1^2 \cdot X_{time}^2 + \sigma^2_r

\end{aligned}\]</span>
<p>Your job is to find the value <span class="math inline">\(X_{time}\)</span>, that will minimize the total variance <span class="math inline">\(\sigma^2_{r_{ij}}\)</span>. In other words, you need to take the derivative of the total variance and show that it is minimized for <span class="math inline">\(X_{time}= -\rho\frac{\tau_0}{\tau_1}\)</span>, and that the smallest variance equals <span class="math inline">\((1-\rho^2)\cdot\tau_0^2+\sigma^2_r\)</span></p>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
